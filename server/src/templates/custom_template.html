<!DOCTYPE html><html lang="zh-CN"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>报价单 - 天津光大钢铁有限公司</title>
<style>@page { margin: 9mm 5mm 5mm 5mm; size: A4; } .container {
    max-width: 100%;
    margin: 0 auto;
    padding: 0 10mm; /* 增加左右内边距，保证视觉边距 */
    background-color: #fff;
    box-shadow: none;
    border-radius: 0;
    box-sizing: border-box; /* 确保内边距不导致溢出 */
    }
.chart-container {
    position: relative;
    margin: 3em auto;
    max-width: 700px;
    min-height: 200px;
    max-height: 400px;
    width: 100%;
    height: auto;
    overflow: visible;
    }
/* 调整 html, body 高度，移除强制 100% */
html, body {
    height: auto;
    min-height: auto;
}
.container, .page-container {
    min-height: 100vh;
}
img {
    display: block;
    overflow: hidden;
    max-width: 100%;
    max-height: 280px;
    margin: 1em auto;
    border-radius: 8px;
    }
/* 图片模式下覆盖全局 img 限制，确保首页 200mm 填满 */
.image-only img {
    max-height: none !important;
    margin: 0 !important;
    border-radius: 0 !important;
}
.image-only .image-slice {
    margin: 0 !important;
}
h1 {
    font-size: 28px;
    margin-top: 24px;
    margin-bottom: 20px;
    }
h2 {
    font-size: 22px;
    }
h3 {
    font-size: 20px;
    }
h4 {
    font-size: 18px;
    }
h5 {
    font-size: 16px;
    }
/* 重置 body，移除 flex 布局等导致样式错乱的属性 */
body {
    font-family: "Helvetica Neue", "Hiragino Sans GB", "WenQuanYi Micro Hei", "Microsoft Yahei", sans-serif;
    background-color: #fff !important;
    color: #333;
    margin: 0;
    padding: 0;
    font-size: 16px;
}
.container, .page-container {
    min-height: auto;
}
img {
    display: block;
    overflow: hidden;
    max-width: 100%;
    max-height: 280px;
    margin: 1em auto;
    border-radius: 8px;
    }
h1 {
    font-size: 28px;
    margin-top: 24px;
    margin-bottom: 20px;
    }
h2 {
    font-size: 22px;
    }
h3 {
    font-size: 20px;
    }
h4 {
    font-size: 18px;
    }
h5 {
    font-size: 16px;
    }
/* 取消容器强制 100vh 高度 */
.container, .page-container {
    min-height: auto;
}
img {
    display: block;
    overflow: hidden;
    max-width: 100%;
    max-height: 280px;
    margin: 1em auto;
    border-radius: 8px;
    }
h1 {
    font-size: 28px;
    margin-top: 24px;
    margin-bottom: 20px;
    }
h2 {
    font-size: 22px;
    }
h3 {
    font-size: 20px;
    }
h4 {
    font-size: 18px;
    }
h5 {
    font-size: 16px;
    }
/* 移除固定白色背景层，避免覆盖与层级问题 */
/* .page-bg {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: #fff !important;
    z-index: -1;
} */
.page-container {
    width: auto; /* 使用内容宽度，结合内边距与页面边距，避免超宽 */
    background: #fff;
    padding: 0 8mm; /* 略微收窄左右内边距，减少换行提升可用空间 */
    box-shadow: none;
    border: none;
    min-height: auto;
    box-sizing: border-box; /* 确保内边距不导致溢出 */
}
.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 2px solid #f0ad4e;
    padding-bottom: 8px;
    margin-bottom: 12px;
    }
.header .logo-container {
    flex-shrink: 0;
    }
.header .logo-container img {
    width: 120px;
    height: auto;
    margin: 0;
    }
.header .title-container {
    text-align: right;
    }
.header h1 {
    font-size: 28px;
    color: #333;
    margin: 0;
    font-weight: 600;
    }
.header h2 {
    font-size: 24px;
    color: #555;
    margin: 10px 0 0;
    font-weight: 400;
    letter-spacing: 2px;
}
.header .company-title-img {
    max-width: 100%;
    height: auto;
    display: inline-block;
    margin: 0;
}
/* 文本标题样式，贴近图片风格且不破坏整体布局 */
.header .company-name-cn {
    font-size: 28px;
    line-height: 32px;
    color: #333;
    font-weight: 700;
    letter-spacing: 2px;
    margin: 0;
}
.header .company-name-en {
    font-size: 14px;
    line-height: 18px;
    color: #777;
    letter-spacing: 2px;
    font-weight: 400;
    margin: 4px 0 0;
    text-transform: uppercase;
}
/* 标题行：左侧logo + 右侧中英文，保证等高 */
.header .title-row {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    grid-template-rows: auto auto;
    column-gap: 10px; /* logo与公司名称间距约10px */
    align-items: center;
    justify-items: center;
    width: 100%;
}
.header .logo-box {
    grid-column: 1;
    grid-row: 1 / span 2;
    align-self: stretch; /* 与标题区域等高，避免破坏网格行高 */
    display: inline-flex;
    align-items: center; /* 小尺寸时垂直居中不撑高 */
    justify-content: center;
}
.header .company-logo {
    /* 采用固定宽度，避免高度限制造成视觉偏小或偏大 */
    width: 160px; /* 再加大一级，增强识别度 */
    height: auto;
    object-fit: contain;
    margin: 0; /* 覆盖全局 img 的上下外边距，防止撑高布局 */
    margin-right: -80px; /* 维持与公司名称的视觉距离 */
}
.header .title-text { grid-column: 2; display: inline-block; text-align: center; }
.quote-info {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px; /* 进一步缩小与列表的间距，避免分页 */
    font-size: 12px; /* 客户信息与报价详情字体略微缩小 */
    }
.quote-info .customer-details, .quote-info .quote-meta {
    width: 48%;
    }
.quote-info h3 {
    font-size: 15px;
    color: #d9534f;
    border-bottom: 1px solid #eee;
    padding-bottom: 8px;
    margin-top: 0;
    margin-bottom: 15px;
    }
.quote-info p {
    margin: 4px 0;
    line-height: 1.5;
    }
.quote-info span {
    color: #555;
    display: inline-block;
    width: 76px;
    }
.quote-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 8px;
    }
.quote-table th, .quote-table td {
    border: 1px solid #ddd;
    padding: 8px 4px;
    text-align: center; /* 表头与内容居中 */
    font-size: 11px;
    font-weight: 600; /* 表头与内容加粗 */
    white-space: nowrap; /* 禁止换行，确保列不换行 */
    }
.quote-table th {
    background-color: #fff;
    color: #333;
    font-weight: 700;
    text-align: center;
    }
.quote-table td {
    color: #555;
    }
.quote-table .text-center {
    text-align: center;
    }
.quote-table .text-right {
    text-align: right;
    }
.quote-table tbody tr:nth-child(odd) { background-color: #fff; }
.quote-table tbody tr:nth-child(even) { background-color: #f9f9f9; }
.summary {
    display: block;
    text-align: right;
    width: 100%;
    /* 消除 inline-block 之间的空白，确保两列可并排 */
    font-size: 0;
    margin-top: 16px;
    margin-bottom: 16px;
    }
.summary .summary-table {
    display: inline-block;
    vertical-align: top;
    /* 恢复子元素字体大小 */
    font-size: 11px; /* 从 10px 增大到 11px，提升可读性 */
    /* 消除表格的外部间距，避免总宽度叠加导致换行 */
    border-collapse: collapse;
    border-spacing: 0;
    table-layout: fixed; /* 固定布局，避免内容撑破并确保列宽生效 */
}
.summary .summary-left {
    margin-right: 8px;
    }
.summary-table {
    width: 38%;
    }

.summary-table td {
    padding: 8px 0 8px 12px;
}
.summary-table .label {
    font-size: 13px; /* 调大字体 */
    font-weight: 600;
    color: #333;
    text-align: right;
    white-space: nowrap; /* 标签不换行 */
    word-break: keep-all;
    width: 48%; /* 固定列宽，避免因内容变化导致布局抖动 */
}
.summary-table .value {
    font-size: 13px; /* 调大字体 */
    text-align: right;
    color: #555;
    white-space: nowrap; /* 值不换行 */
    word-break: keep-all;
    overflow: hidden; /* 超出时隐藏，保持单行布局 */
    text-overflow: ellipsis; /* 超出时省略，避免挤出容器 */
    width: 52%; /* 固定列宽，保证两列总宽稳定 */
}
.summary-table .grand-total .label, .summary-table .grand-total .value {
    font-size: 15px; /* 调大总计金额字体 */
    font-weight: bold;
    color: #d9534f;
    }
.total-in-words {
    text-align: right;
    font-weight: 600;
    margin-top: 3px;
    margin-bottom: 5px;
    }
/* 金额大写适度放大，提升辨识度（修正选择器位置，避免嵌套无效） */
.summary-table .total-words .label, .summary-table .total-words .value {
    font-size: 13px; /* 调大金额大写字体 */
}
/* 还原底部备注与联系信息样式（橙色主题） */
.footer { margin-top: 10px; font-size: 12px; }
.footer .remarks { background: #ffe8d6; border: 1px solid #f0a36b; padding: 8px; }
.footer .contact { margin-top: 8px; }
/* 恢复底部备注与签章样式 */
.footer { margin-top: 20px; font-size: 12px; color: #333; }
.footer .remarks-block { background: #fff; border: 1px solid #ddd; padding: 10px 12px; }
.footer .remarks-block h3 { font-size: 14px; margin: 0 0 8px; color: #d9534f; }
.footer .signature-block { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 12px; }
.footer .signature-block .stamp-placeholder { width: 120px; height: 120px; border: 2px dashed #f0ad4e; border-radius: 50%; text-align: center; line-height: 120px; color: #f0ad4e; font-weight: 600; }
.footer .signature-block .company-info { text-align: right; flex: 1; margin-left: 16px; }
/* 底部容器（与图片一致）：上边框 + 左右结构 */
.footer { border-top: 1px solid #e5e5e5; margin-top: 16px; padding-top: 10px; padding-bottom: 0; }
.footer .footer-grid { display: grid; grid-template-columns: 3fr 2fr; column-gap: 8px; align-items: start; }
/* 左侧备注 */
.footer .remarks-section h3 { font-size: 14px; font-weight: 700; color: #d9534f; margin: 10px 0 8px; }
.footer .remarks-section .remarks-validity { font-size: 13px; color: #555; margin: 0 0 6px; }
.footer .remarks-section .remarks-content { font-size: 13px; color: #666; line-height: 1.8; white-space: pre-line; }
.footer .remarks-section .remarks-list { margin: 0; padding-left: 18px; }
.footer .remarks-section .remarks-list li { margin: 2px 0; line-height: 1.8; color: #666; }
/* 右侧签章区域改为上-中-下结构，并允许签章与公司名部分重叠 */
.footer .signature-section { text-align: center; }
.footer .signature-section .signature-stack { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 6px; }
/* 放大签章区域，并略微上移以与公司名产生覆盖 */
.footer .signature-section .signature-layer { position: relative; width: 180px; height: 180px; display: flex; align-items: center; justify-content: center; margin-top: -8px; }
/* 公司名称下移一些，以避免过于靠上，同时允许被签章覆盖 */
.footer .signature-section .company-name { position: relative; z-index: 2; font-weight: 700; color: #000; font-size: 14px; margin: 10px 0 0; }
/* 放大签章图像并提高层级以覆盖公司名称 */
.footer .signature-section .stamp-image { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 180px; height: 180px; object-fit: contain; display: block; opacity: 0.95; z-index: 3; }
.footer .signature-section .stamp-fallback { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 180px; height: 180px; display: block; opacity: 0.95; z-index: 3; }
.footer .signature-section .signature-date { margin-top: 0; border-top: none; padding-top: 0; text-align: center; font-size: 12px; color: #333; }
/* 打印分页控制：确保底部签章与日期作为一个整体不会被分页拆分 */
@media print {
  /* 保持原尺寸打印，避免头部logo被缩小；底部区域避免被分页拆分 */
  .page-container { zoom: 1; transform-origin: top center; page-break-inside: auto; }
  .summary { page-break-inside: avoid; }
  /* 条件分页：当存在 force-break-before 类时，摘要前强制分页 */
  .force-break-before { page-break-before: always; break-before: page; }
  /* 仅保护签章栈与日期不被拆分，避免整个footer被整体推到下一页 */
  .signature-section, .signature-stack, .signature-date { page-break-inside: avoid; }
  /* 新增：确保“备注与说明 + 签章”这一整块作为整体不被分页拆分 */
  .footer, .footer-grid, .footer .remarks-section, .footer .signature-section { page-break-inside: avoid; break-inside: avoid; }
}
</style>
</head>
<body>
<div class="container">
<div class="page-container">
<header class="header">
<div class="title-container" style="text-align: center; width: 100%;">
  <div class="title-row">
    {{#if companyLogoUrl}}
      <div class="logo-box">
        <img src="{{companyLogoUrl}}" alt="公司logo" class="company-logo" />
      </div>
    {{/if}}
    <div class="title-text">
      <div class="company-name-cn">天津光大钢铁有限公司</div>
      <div class="company-name-en">TIANJIN GUANGDA STEEL CO., LTD.</div>
    </div>
  </div>
  <h2 id="section-1">报 价 单</h2>
</div>
</header>
<section class="quote-info">
<div class="customer-details">
<h3 id="section-1-1">客户信息</h3>
<p><span>公司名称:</span> {{customerName}}</p>
<p><span>公司地址:</span> {{companyAddress}}</p>
<p><span>联 系 人:</span> {{contactPerson}}</p>
<p><span>联系电话:</span> {{phone}}</p>
<p><span>收货地址:</span> {{customerAddress}}</p>
</div>
<div class="quote-meta">
<h3 id="section-1-2">报价详情</h3>
<p><span>报价单号:</span> {{quoteNumber}}</p>
<p><span>报价日期:</span> {{quoteDate}}</p>
<p><span>有 效 期:</span> {{validityPeriod}}</p>
<p><span>销售代表:</span> {{salesRep}}</p>
<p><span>销售电话:</span> {{salesRepPhone}}</p>
</div>
</section>
{{#unless imageOnlyMode}}
<table class="quote-table">
  {{#if steelStructureMode}}
  <thead>
    <tr>
      <th style="width:6%;">序号</th>
      <th style="width:28%;">工序项目</th>
      <th style="width:12%;">计量单位</th>
      <th style="width:14%;">单价(元)</th>
      <th style="width:16%;">金额(元)</th>
      <th style="width:24%;">备注</th>
    </tr>
  </thead>
  <tbody>
    {{#each steelItems}}
    <tr>
      <td>{{index}}</td>
      <td>{{processItem}}</td>
      <td>{{processUnit}}</td>
      <td>{{unitPrice}}</td>
      <td>{{totalPrice}}</td>
      <td>{{remark}}</td>
    </tr>
    {{/each}}
  </tbody>
  {{else}}
  <thead>
    <tr>
      <th style="width:5%;">序号</th>
      <th style="width:20%;">产品名称</th>
      <th style="width:18%;">规格型号</th>
      <th style="width:8%;">材质</th>
      <th style="width:8%;">数量</th>
      <th style="width:8%;">单位</th>
      <th style="width:10%;">单价(元)</th>
      <th style="width:10%;">金额(元)</th>
      <th style="width:13%;">备注</th>
    </tr>
  </thead>
  <tbody>
    {{#each items}}
    <tr>
      <td>{{index}}</td>
      <td>{{itemName}}</td>
      <td>{{specification}}</td>
      <td>{{material}}</td>
      <td>{{quantity}}</td>
      <td>{{unit}}</td>
      <td>{{unitPrice}}</td>
      <td>{{totalPrice}}</td>
      <td>{{remark}}</td>
    </tr>
    {{/each}}
  </tbody>
  {{/if}}
</table>
{{/unless}}
{{#if imageOnlyMode}}
<div class="image-only" style="margin:8px 0;">
  <div id="imageSlicesContainer"></div>
</div>
<script>
(function(){
  try {
    var url = '{{itemsImageUrl}}';
    if (!url) { window.__readyForPrint = true; return; }
    var container = document.getElementById('imageSlicesContainer');
    if (!container) { window.__readyForPrint = true; return; }
    var mmBox = document.createElement('div');
    mmBox.style.height = '200mm';
    mmBox.style.visibility = 'hidden';
    mmBox.style.position = 'absolute';
    mmBox.style.top = '-9999mm';
    document.body.appendChild(mmBox);
    var sliceHeightPx = mmBox.clientHeight;
    document.body.removeChild(mmBox);

    var contentEl = document.querySelector('.container');
    var contentWidthPx = contentEl ? contentEl.clientWidth : 800;

    var img = new Image();
    img.crossOrigin = 'anonymous';
    img.onload = function(){
      var naturalW = img.naturalWidth || contentWidthPx;
      var naturalH = img.naturalHeight || contentWidthPx;
      // 以容器宽度的显示高度为基准
      var displayedAtBasePx = contentWidthPx * naturalH / naturalW;
      // 如果首片高度不足 200mm，则按比例放大（统一用于所有切片）
      var scale = displayedAtBasePx < sliceHeightPx ? (sliceHeightPx / displayedAtBasePx) : 1;
      var scaledW = Math.ceil(contentWidthPx * scale);
      var scaledH = Math.ceil(scaledW * naturalH / naturalW);
      var effScale = scaledW / naturalW; // 从原始尺寸到放大尺寸的比例

      var sliceCount = Math.max(1, Math.ceil(scaledH / sliceHeightPx));
      for (var i=0;i<sliceCount;i++){
        var remaining = scaledH - i * sliceHeightPx;
        var currentHeightPx = i === 0 ? sliceHeightPx : Math.min(sliceHeightPx, remaining);

        var wrap = document.createElement('div');
        wrap.className = 'image-slice';
        wrap.style.width = '100%';
        wrap.style.height = i === 0 ? '200mm' : currentHeightPx + 'px';
        wrap.style.overflow = 'hidden';
        wrap.style.pageBreakInside = 'avoid';

        // 使用 Canvas 裁剪生成每片，保证宽度 100% 显示
        var canvas = document.createElement('canvas');
        canvas.width = contentWidthPx;
        canvas.height = currentHeightPx;
        var ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = true;

        // 计算原图的裁剪起点与高度（按放大后的比例逆推到原图坐标）
        var syNat = Math.floor((i * sliceHeightPx) / effScale);
        var sHeightNat = Math.floor(currentHeightPx / effScale);
        if (syNat + sHeightNat > naturalH) {
          sHeightNat = Math.max(0, naturalH - syNat);
        }

        ctx.drawImage(
          img,
          0, syNat, naturalW, sHeightNat,
          0, 0, contentWidthPx, currentHeightPx
        );

        var inner = document.createElement('img');
        inner.src = canvas.toDataURL('image/png');
        inner.style.width = '100%';
        inner.style.height = i === 0 ? '200mm' : currentHeightPx + 'px';
        inner.style.display = 'block';
        inner.style.margin = '0';
        inner.style.position = 'relative';

        wrap.appendChild(inner);
        container.appendChild(wrap);
      }
      window.__readyForPrint = true;
    };
    img.onerror = function(){ window.__readyForPrint = true; };
    img.src = url;
  } catch(e) { window.__readyForPrint = true; }
})();
</script>
{{/if}}
{{#unless steelStructureMode}}
<div class="summary {{#if forceBreakBeforeSummary}}force-break-before{{/if}}">
  <table class="summary-table summary-left">
    <tbody>
      <tr>
        <td class="label">商品合计</td>
        <td class="value">{{totalAmount}} 元</td>
      </tr>
      <tr>
        <td class="label">税额 ({{taxRatePercentDisplay}})</td>
        <td class="value">{{taxAmount}} 元</td>
      </tr>
    </tbody>
  </table>
  <table class="summary-table summary-right">
    <tbody>
      <tr class="grand-total">
        <td class="label">总计金额</td>
        <td class="value">{{grandTotal}} 元</td>
      </tr>
      <tr class="total-words">
        <td class="label">金额大写</td>
        <td class="value">{{totalAmountUppercase}}</td>
      </tr>
    </tbody>
  </table>
</div>
{{/unless}}
<!-- 已移除重复的金额大写汇总块，保留左右两列结构 -->
<!-- 底部样式与图片一致：左侧备注与说明 / 右侧签章与日期（公司名位于印章右侧水平排列） -->
<div class="footer">
  <div class="footer-grid">
    <div class="remarks-section">
      <h3>备注与说明:</h3>
      <ol class="remarks-list">
        <li>以上价格{{#if (eq freightIncluded '是')}}含{{else}}不含{{/if}}运费</li>
        <li>最终成交交割以双方签订的销售合同为准</li>
        <li>如对本报价有任何疑问，请随时联系销售代表</li>
        {{#if remarks}}
        <li>关于本报价单备注：{{remarks}}</li>
        {{/if}}
      </ol>
    </div>
    <div class="signature-section">
      <div class="signature-stack">
        <p class="company-name">{{companyName}}</p>
        <div class="signature-layer">
          {{#if stampImageUrl}}
          <img class="stamp-image" src="{{stampImageUrl}}" alt="公司签章" onload="if(this.nextElementSibling){this.nextElementSibling.style.display='none'}" onerror="this.style.display='none'; if(this.nextElementSibling){this.nextElementSibling.style.display='block'}" />
          <svg class="stamp-fallback" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" style="display: none;">
            <defs>
              <circle id="ringPathBar" cx="100" cy="100" r="90" />
            </defs>
            <circle cx="100" cy="100" r="90" fill="none" stroke="#cc3d3d" stroke-width="6" />
            <polygon points="100,60 112,95 150,95 118,115 130,150 100,130 70,150 82,115 50,95 88,95" fill="#cc3d3d" />
            <text font-size="14" fill="#cc3d3d" font-family="'Microsoft YaHei', 'SimSun', sans-serif">
              <textPath href="#ringPathBar" startOffset="6%">天津光大钢铁有限公司 销售专用章</textPath>
            </text>
          </svg>
          {{else}}
          <svg class="stamp-fallback" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" style="display: block;">
            <defs>
              <circle id="ringPathBar" cx="100" cy="100" r="90" />
            </defs>
            <circle cx="100" cy="100" r="90" fill="none" stroke="#cc3d3d" stroke-width="6" />
            <polygon points="100,60 112,95 150,95 118,115 130,150 100,130 70,150 82,115 50,95 88,95" fill="#cc3d3d" />
            <text font-size="14" fill="#cc3d3d" font-family="'Microsoft YaHei', 'SimSun', sans-serif">
              <textPath href="#ringPathBar" startOffset="6%">天津光大钢铁有限公司 销售专用章</textPath>
            </text>
          </svg>
          {{/if}}
        </div>
        <div class="signature-date">签章日期：{{quoteDate}}</div>
      </div>
    </div>
  </div>
</div>
<!-- 底部签章区按旧版样式不显示占位与公司重复信息 -->
</div>
<!-- 移除可能引入灰色背景的空 reference-container -->
</div></div>
</body></html>